-- 1
select distinct(replacement_cost) 
from film
order by replacement_cost;

-- 2
select 
(case 
	when replacement_cost < 20 then 'low'
	when replacement_cost < 25 then 'medium'
	when replacement_cost < 30 then 'high'
end) as replacement_group,
count(*) as no_of_films
from film
group by 1;

-- 3 
select f.title,f.length,c.name
from film f
join film_category fc on f.film_id = fc.film_id
join category c on c.category_id = fc.category_id
where c.name in ('Drama','Sports')
order by f.length desc;

-- 4 how many titles are there in each category
select name,count(title) from film f 
join film_category fc on f.film_id = fc.film_id
join category c on fc.category_id = c.category_id
group by name
order by count(title) desc;

-- 5
select first_name,last_name,count(*)
from actor a join film_actor fa on a.actor_id = fa.actor_id
join film f on f.film_id = fa.film_id
group by first_name,last_name
order by count(*) desc;

-- 6
select * from address a 
left join customer c on a.address_id = c.address_id
where c.address_id is null;

-- 7
select first_name,last_name,ci.city,sum(p.amount) as total_amount from payment p
join customer c on p.customer_id = c.customer_id
join address a on c.address_id = a.address_id
join city ci on a.city_id = ci.city_id
group by 1,2,3
order by 4 desc;

-- 8
select (cu.country||', '|| ci.city) as "country, city", sum(p.amount) as revenue from payment p
join customer c on p.customer_id = c.customer_id
join address a on c.address_id = a.address_id
join city ci on a.city_id = ci.city_id
join country cu on ci.country_id = cu.country_id
group by 1
order by 2 asc;

-- 9 
select staff_id,round(avg(total),2) from   
(select staff_id,customer_id,sum(amount) as total from payment
group by staff_id,customer_id
order by 2) 
group by staff_id;

-- 10
select round(avg(total),2)
from
(select 
date(payment_date),
extract(dow from payment_date) as sundays,sum(amount) as total
from payment
where extract(dow from payment_date) = 0
group by 1,2);

-- 11
select title,length,replacement_cost
from film f1
where length > (select avg(length) from film f2
	where f1.replacement_cost = f2.replacement_cost)
order by length asc;

-- 12
select district, round(avg(total),2)
from
(select district,p.customer_id,sum(amount) as total
from payment p join customer c on p.customer_id = c.customer_id
join address a on a.address_id = c.address_id
group by district,p.customer_id)
group by district 
order by 2 desc;



